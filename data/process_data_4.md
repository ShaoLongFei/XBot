# 七牛云技术支持问答数据集 - Part 4

## 1. 使用kodo browser如何全部下载

**分类**: 对象存储｜上传下载

**问题描述**: 客户尝试使用kodo browser工具全部下载文件时遇到问题,点击全部下载直接卡死无法正常使用。空间内共有约3万多个文件需要下载。

**客服解答**:
1. 提供了两种批量下载方式:
   - 方法1: 使用qshell命令行工具进行批量下载
     - 工具下载地址: https://github.com/qiniu/qshell
     - 批量下载命令文档: https://github.com/qiniu/qshell/blob/master/docs/qdownload.md
     - 注意: 公开空间使用CDN域名下载时,建议将public参数置为true以击中CDN缓存
   - 方法2: 使用图形化工具kodo browser,勾选文件后点击下载
2. 针对qshell在Windows平台闪退问题:
   - 需要在命令行终端(cmd)中打开使用,不能直接双击运行
   - 提供了操作教程视频: https://developer.qiniu.com/kodo/kb/3858/video-of-how-to-use-qrs-tools
3. 配置文件注意事项:
   - Windows系统下dest_dir路径需使用双斜杠,如: "D:\\qnyimg"
   - 下载全部文件不需要设置prefix和suffixes参数
   - 配置示例中空值字段需删除
4. 关于目录结构:
   - 控制台的目录是虚拟目录,基于文件名路径自动扩展
   - 下载会保留完整的文件路径结构

**根本原因分析**: 
客户遇到的问题是工具使用不当导致的。kodo browser图形化工具在处理大量文件(3万+)时可能出现性能问题导致卡死。qshell命令行工具闪退是因为在Windows下直接双击运行而非在cmd命令行中执行。客户对qshell工具的配置文件格式不熟悉,在dest_dir路径、配置参数等方面存在错误配置。

**隐私数据脱敏**: 已处理 (URL、密钥、邮箱、电话、IP等敏感信息已脱敏)

---

## 2. 域名被冻结不能访问,需要立刻解决

**分类**: CDN｜其他类咨询

**问题描述**: 客户的测试域名hb-bkt-clouddn-com-idvcz9a.www.qiniudns.com被冻结,无法访问。客户表示正在办理展会,情况非常紧急,希望临时开放测试域名。

**客服解答**:
1. 测试域名使用限制说明:
   - 每个自然日访问回源总流量限10GB
   - 当日回源流量达到10GB后会禁止对新文件的访问并冻结测试域名
   - 详细规则参考: https://developer.qiniu.com/fusion/kb/1319/test-domain-access-restriction-rules
2. 测试域名具体限制:
   - 不得存储、发布、传播违法违规内容
   - 自2018年7月18日起禁止下载移动应用程序(apk、ipa等)
   - 测试域名生命周期为30个自然日,超期自动回收
3. 解决方案:
   - 不支持临时开放已冻结的测试域名
   - 需要绑定自定义域名使用

**根本原因分析**: 
测试域名被冻结是因为触发了每日10GB回源流量的限制。这是七牛云对测试域名的保护性限制措施,旨在防止滥用。客户在展会等业务场景中使用测试域名,当访问量较大时很容易超出流量限制。根本解决方案是使用已备案的自定义域名,而非依赖测试域名。

**隐私数据脱敏**: 已处理 (URL、密钥、邮箱、电话、IP等敏感信息已脱敏)

---

## 3. 你们的oss干的太棒可

**分类**: 对象存储｜上传下载

**问题描述**: 客户反映上传文件后,外链和文件名对不上。客户语气中表达了不满。

**客服解答**: 未提供具体解答(工单信息不完整)

**根本原因分析**: 
从客户描述来看,可能是文件上传后生成的外链URL与实际文件名不匹配。这种情况通常由以下原因造成: 1) 上传时使用了自定义key(文件名),但访问时使用了错误的URL; 2) 上传时发生了文件名编码问题; 3) 客户对七牛云的文件访问机制(域名+key)理解有偏差。由于对话记录过于简短,无法确定具体原因。

**隐私数据脱敏**: 已处理 (URL、密钥、邮箱、电话、IP等敏感信息已脱敏)

---

## 4. 我上传的视频链接,只能在电脑端播放,无法在微信小程序端播放,不知道如何解决

**分类**: 对象存储｜其他类咨询

**问题描述**: 客户上传的视频链接https://jr.mqhdshop.com/day1/day1.mp4在电脑浏览器上可以正常访问打开,但是在微信小程序上无法播放,没有具体报错信息。

**客服解答**:
1. iOS微信浏览器MP4文件无法播放的常见原因:
   - H.264编码的压缩级别(Profile Level)问题
   - 压缩级别高于苹果支持的级别会导致iOS下无法播放
   - 苹果官方文档要求: H.264基准配置文件级别3.0～H.264高配置级别4.1之间
2. 解决方法:
   - 方法1: 使用七牛转码接口avthumb/mp4重新处理视频
     - 转码参数文档: https://developer.qiniu.com/dora/manual/1248/audio-and-video-transcoding-avthumb
     - 提供了Java、PHP、Python、Node.js、Go等多种语言SDK示例
   - 方法2: 在控制台多媒体队列中提交转码任务
     - 操作文档: https://developer.qiniu.com/dora/6486/submit-transcoding-task-quickly

**根本原因分析**: 
视频在iOS微信小程序中无法播放的根本原因是视频编码格式兼容性问题。H.264编码有三种画质级别(baseline、main、high),如果视频使用的压缩级别超出了iOS平台的支持范围,就会导致播放失败。安卓平台兼容性较好所以能正常播放,而iOS系统对视频编码要求更严格。这是移动端视频播放的常见兼容性问题。

**隐私数据脱敏**: 已处理 (URL、密钥、邮箱、电话、IP等敏感信息已脱敏)

---

## 5. 请问帐户余额如何提现?

**分类**: 账户与财务｜其他类咨询

**问题描述**: 客户咨询账户余额如何提现。充值时间较久,已超过原路提现的时间限制。

**客服解答**:
1. 提现方式说明:
   - 支持自助申请原路提现(支付宝、微信、网上银行)
   - 支持线下提现(银行卡)
   - 提现入口: https://portal.qiniu.com/financial/withdraw
2. 提现注意事项:
   - 需将对应充值的增值税发票退回七牛云
   - 原路提现预计3～5个工作日
   - 线下提现预计5～15个工作日
   - 可提现金额需扣除实时消费、欠票金额、赠送金额和未支付金额
3. 超期充值处理:
   - 微信充值(充值时间<330天)可原路退回
   - 支付宝充值(充值时间<330天)可原路退回
   - 网上银行充值(充值时间<80天)可原路退回
   - 超过时间限制的可走线下打款,原路退回到原充值账号
4. 处理流程:
   - 客户提供支付宝账号信息
   - 客服反馈财务处理
   - 财务一般周四打款,未收到会顺延到下周工作日

**根本原因分析**: 
客户的提现需求是因为长期未使用账户余额,现在需要将资金取出。由于充值时间过久已超过原路提现的时间窗口(支付宝330天、微信330天、网银80天),需要走线下提现流程。这种情况的根本原因是客户对平台提现规则不了解,且长期未关注账户余额使用情况。七牛云设置提现时间限制主要是为了防止洗钱等金融风险。

**隐私数据脱敏**: 已处理 (URL、密钥、邮箱、电话、IP等敏感信息已脱敏)

---

## 6. 解冻域名处理中

**分类**: CDN｜配置问题

**问题描述**: 客户充值后域名一直没有解冻恢复,访问时出现报错。域名之前因账户欠费被冻结,冻结期间数据已被清理。

**客服解答**:
1. 域名解冻处理:
   - 客服确认后已解冻域名
2. 数据恢复问题:
   - 访问报错是因为没有请求到资源数据
   - 账户于2024-07-29被冻结,2024-09-23解冻
   - 冻结31个自然日后仍欠费,数据已被删除且不可恢复
   - 欠费冻结须知: https://developer.qiniu.com/af/kb/1543/lack-of-information
3. 解决方案:
   - 需要重新创建对象存储空间
   - 重新绑定域名
   - 重新上传数据

**根本原因分析**: 
域名无法访问的根本原因是账户欠费冻结导致。七牛云的欠费处理机制是: 账户冻结后有31天的数据保留期,如果31天后仍未充值,系统会自动删除数据且不可恢复。客户在2024-07-29被冻结,到2024-09-23解冻时已超过31天数据保留期,因此数据已被永久删除。客户希望恢复备份,但七牛云并不为用户保留数据备份,所有数据完全由用户自行管理。这提醒用户需要及时关注账户余额,做好本地数据备份。

**隐私数据脱敏**: 已处理 (URL、密钥、邮箱、电话、IP等敏感信息已脱敏)

---

## 7. 怎么给其他人创建用户,专门用来管理存储空间

**分类**: 账户与财务｜账户问题

**问题描述**: 客户在用户管理中创建了子账号用户后,该用户登录时会提示需要注册七牛账号。

**客服解答**:
1. 子账号登录方式说明:
   - 在https://portal.qiniu.com/iam/overview创建的子账号
   - 需要通过IAM专用登录链接登录
   - 不能使用七牛云主站登录入口
2. 操作指引:
   - 在IAM概览页面获取专用登录链接
   - 使用专用链接登录子账号

**根本原因分析**: 
客户遇到的问题是对七牛云的IAM(身份与访问管理)系统不熟悉导致的。七牛云的主账号和子账号使用不同的登录入口,子账号是通过IAM系统创建的,必须使用IAM专用登录链接才能登录,而不能使用七牛云主站的登录页面。如果使用主站登录,系统会识别为新用户注册。这是云服务商常见的权限管理机制,用于实现企业级的账号权限隔离。

**隐私数据脱敏**: 已处理 (URL、密钥、邮箱、电话、IP等敏感信息已脱敏)

---

## 8. 文件客户端缓存设置问题

**分类**: 对象存储｜其他类咨询

**问题描述**: 客户希望文件不在客户端缓存,咨询如何设置。尝试将缓存时间设置为0秒但系统要求必须为正整数。

**客服解答**:
1. 客户端缓存控制:
   - 如果需要客户端不缓存,在浏览器本地配置停用缓存即可
   - 可以百度搜索对应浏览器如何关闭缓存
2. CDN节点缓存控制:
   - 如果需要CDN节点不缓存,在CDN的缓存配置中设置为0秒
   - 注意区分对象存储空间的缓存配置和CDN的缓存配置
3. 客户需求澄清:
   - 客户实际需求是CDN节点不缓存
   - 希望资源更新后网站打开不需要刷新即可看到最新内容
   - 应在CDN产品处设置缓存配置,而非对象存储空间

**根本原因分析**: 
客户对"缓存"概念的理解存在混淆。缓存分为多个层级: 1)客户端浏览器缓存; 2)CDN边缘节点缓存; 3)对象存储源站。客户最初在对象存储空间设置中尝试配置,但对象存储的缓存配置项有最小值限制。客户的实际需求是CDN节点不缓存,这样资源更新后用户可以立即看到新版本。应该在CDN域名管理中配置缓存策略,而不是在对象存储空间中配置。这反映了客户对CDN工作原理和缓存层级的理解不够深入。

**隐私数据脱敏**: 已处理 (URL、密钥、邮箱、电话、IP等敏感信息已脱敏)

---

## 9. 关于七牛云上传的视频访问流量费用问题

**分类**: 对象存储｜上传下载

**问题描述**: 客户对上传到七牛云的视频在线观看时收取的费用不清楚,希望找工作人员对接了解。

**客服解答**:
1. 费用构成说明:
   - 使用了七牛的存储服务和CDN服务
   - 可能产生的费用包括:
     - 数据存储费用
     - CDN下载流量费用
     - CDN回源流出流量费用
2. 免费额度说明:
   - 存储空间免费额度: 10GB/月
   - CDN下载流量免费额度: 10GB/月
   - 回源流出流量免费额度: 10GB/月
3. CDN流量和回源流量区别:
   - CDN流量: 用户访问CDN时,CDN节点与用户之间产生的流量
   - CDN回源流量: CDN节点与源站之间产生的流量

**根本原因分析**: 
客户的困惑源于对云存储和CDN服务的计费模型不够了解。视频在线观看涉及多个环节的费用: 1)视频文件存储在对象存储中产生存储费用; 2)用户观看时从CDN下载产生CDN流量费用; 3)CDN节点缓存未命中时回源拉取产生回源流量费用。很多用户只关注存储费用,而忽略了流量费用往往是大头,特别是视频这类大文件。客户希望工作人员详细对接,说明对计费规则理解不够透彻,需要更详细的说明。

**隐私数据脱敏**: 已处理 (URL、密钥、邮箱、电话、IP等敏感信息已脱敏)

---

## 10. 用户获取证书列表的接口一直调用不通?

**分类**: CDN｜其他类咨询

**问题描述**: 客户使用Java调用获取SSL证书列表的API接口时一直返回"bad token"错误。接口地址为https://api.qiniu.com/sslcert?marker=1&limit=100,使用了正确的Authorization和Content-Type头。

**客服解答**:
1. 提供Java调用示例代码:
```java
package com.qiniuts;
import com.qiniu.http.Client;
import com.qiniu.util.Auth;
import com.qiniu.util.StringMap;
import org.junit.Test;
public class FusionTest {
    private static final String ACCESS_KEY = "IsUiK1DPt***********2JyK3S87B";
    private static final String SECRET_KEY = "qRCE5DC-S***********eJt2t8Jmx";
    private static final Auth auth = Auth.create(ACCESS_KEY, SECRET_KEY);
    @Test
    public void sslGet() throws Exception {
        Auth auth = Auth.create(ACCESS_KEY, SECRET_KEY);
        String url = "http://api.qiniu.com/sslcert";
        String accessToken = "QBox " + auth.signRequest(url,null, "application/x-www-form-urlencoded");
        Client client = new Client();
        StringMap headers = new StringMap();
        headers.put("Authorization", accessToken);
        try {
            com.qiniu.http.Response resp = client.get(url,headers);
            System.out.println(resp.bodyString());
        } catch (Exception e) {
            throw new Exception(e.getMessage());
        }
    }
}
```
2. 关键点:
   - 使用七牛Java SDK的Auth类进行签名
   - 使用signRequest方法生成签名
   - 注意协议使用http而非https
   - Authorization头格式为"QBox " + 签名

**根本原因分析**: 
客户的"bad token"错误是因为token签名算法不正确。从客户提供的信息看,虽然使用了正确的AK/SK和API地址,但签名生成方式有问题。七牛云的API鉴权需要使用特定的签名算法(QBox签名),包括对请求URL、请求头、请求体按照特定规则进行HMAC-SHA1签名。客户可能是自己实现签名算法时出现了错误,而没有使用官方SDK提供的Auth工具类。使用官方SDK可以避免签名算法实现错误。

**隐私数据脱敏**: 已处理 (URL、密钥、邮箱、电话、IP等敏感信息已脱敏)

---
